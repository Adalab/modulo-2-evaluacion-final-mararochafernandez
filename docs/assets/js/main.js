"use strict";const API_URL="https://api.jikan.moe/v3/search/anime",DEFAULT_IMAGE="https://via.placeholder.com/227x320/e5e5e5/666/?text=TV",RESULTS_TITLE="Resultados",FAVORITES_TITLE="Series favoritas";let searchTerm="naruto",lastPage=0,currentPage=1,animeSeries=[],favorites=[];function findIndex(e,t){return e.findIndex(e=>e.mal_id===t)}function findItem(e,t){return e.find(e=>e.mal_id===t)}function renderFavorites(){const e=document.querySelector(".js-favorites");if(e.textContent="",favorites.length>0){const t=renderTitle(FAVORITES_TITLE),r=renderList(FAVORITES_TITLE,favorites);e.appendChild(t),e.appendChild(r);const n=renderResultsButton("Borrar series favoritas",handleRemoveAllFavorites);e.appendChild(n),e.classList.add("favorites")}else e.classList.remove("favorites")}function renderAnimeSeries(){const e=document.querySelector(".js-results");if(e.textContent="",animeSeries.length>0){const t=renderTitle("Resultados"),r=renderList("Resultados",animeSeries);if(e.appendChild(t),e.appendChild(r),currentPage<lastPage){const t=renderResultsButton("Cargar mÃ¡s resultados",handleLoadMoreResults);e.appendChild(t)}}}function renderTitle(e){const t=document.createElement("h2");return t.className="results__title",t.textContent=e,t}function renderList(e,t){const r=document.createElement("ul");r.className="results__list";for(const n of t){const t=renderListItem(n),s=renderImage(n),a=renderSubtitle(n);t.appendChild(s),t.appendChild(a);const i=document.createElement("p");if(i.className="results__type",i.textContent=n.type,t.appendChild(i),"Resultados"===e)t.addEventListener("click",handleListItem);else{const e=renderIcon();t.appendChild(e)}r.appendChild(t)}return r}function renderListItem(e){const t=document.createElement("li");t.dataset.id=e.mal_id;const r=findItem(favorites,e.mal_id);return t.className=r?"results__item results__item--favorite":"results__item",t}function renderImage(e){const t=document.createElement("img");return t.className="results__image",t.src=e.image_url&&e.image_url.includes("https://cdn.myanimelist.net/images/anime/")?e.image_url:DEFAULT_IMAGE,t.alt=e.title,t}function renderSubtitle(e){const t=document.createElement("h3");return t.className="results__subtitle",t.textContent=e.title,t}function renderIcon(){const e=document.createElement("i");return e.className="fas fa-times-circle",e.addEventListener("click",handleIcon),e}function renderResultsButton(e,t){const r=document.createElement("button");return r.className="main__button main__button--results",r.type="button",r.textContent=e,r.addEventListener("click",t),r}function getAnimeSeriesFromApi(){1===currentPage&&(animeSeries=[]),fetch(`${API_URL}?q=${searchTerm}&page=${currentPage}`).then(e=>e.json()).then(e=>{lastPage=e.last_page,animeSeries=animeSeries.concat(e.results),renderAnimeSeries()})}function getFavoritesFromLocalStorage(){const e=JSON.parse(localStorage.getItem("favorites"));e&&(favorites=e)}function setFavoritesInLocalStorage(){favorites.length>0?localStorage.setItem("favorites",JSON.stringify(favorites)):removeFavoritesFromLocalStorage()}function removeFavoritesFromLocalStorage(){localStorage.removeItem("favorites")}function listenSearchForm(){const e=document.querySelector(".js-button-search"),t=document.querySelector(".js-button-reset"),r=document.querySelector(".js-button-log");e.addEventListener("click",handleSearch),t.addEventListener("click",handleReset),r.addEventListener("click",handleLog)}function handleSearch(e){e.preventDefault();const t=document.querySelector(".js-search-term");searchTerm=t.value,searchTerm&&searchTerm.length>=3?(currentPage=1,getAnimeSeriesFromApi()):(animeSeries=[],renderAnimeSeries())}function handleReset(e){e.preventDefault();document.querySelector(".js-search-term").value="",currentPage=1,animeSeries=[],renderAnimeSeries()}function handleListItem(e){handleFavorites(e.currentTarget)}function handleIcon(e){handleFavorites(e.currentTarget.parentNode)}function handleFavorites(e){const t=parseInt(e.dataset.id),r=findIndex(animeSeries,t),n=findIndex(favorites,t);-1===n?(favorites.push(animeSeries[r]),e.classList.add("results__item--favorite")):(favorites.splice(n,1),e.classList.remove("results__item--favorite")),renderFavorites(),renderAnimeSeries(),setFavoritesInLocalStorage()}function handleRemoveAllFavorites(){favorites=[],renderFavorites(),renderAnimeSeries(),removeFavoritesFromLocalStorage()}function handleLoadMoreResults(e){currentPage++,getAnimeSeriesFromApi(),e.currentTarget.remove()}function handleLog(e){e.preventDefault();for(const e of favorites)console.log(e.title)}getFavoritesFromLocalStorage(),renderFavorites(),listenSearchForm();